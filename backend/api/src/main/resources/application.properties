spring.application.name=sdmis-api

# Datasource configuration (overridable via env)
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Keep legacy schema init disabled (DB must exist)
spring.sql.init.mode=never

# JDBC template logging (set to DEBUG to trace queries)
logging.level.org.springframework.jdbc.core=INFO

# CORS (pour les appels front)
spring.web.cors.allowed-origins=*
spring.web.cors.allowed-methods=GET,POST,PUT,PATCH,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.exposed-headers=*

# Respect X-Forwarded-* headers (needed behind HTTPS reverse proxy for correct scheme in Swagger/OpenAPI)
server.forward-headers-strategy=framework

# Sécurité / Keycloak (fallback vers l'URL publique si variables non fournies)
#spring.security.oauth2.resourceserver.jwt.issuer-uri=${KEYCLOAK_ISSUER_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS}
# On se base sur le JWKS direct pour éviter les appels discovery au démarrage.
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=${KEYCLOAK_JWKS_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS/protocol/openid-connect/certs}

# Client OAuth2 (pour oauth2Login / Swagger) – override via env si besoin
spring.security.oauth2.client.registration.sdmis-api-swagger.client-id=${KEYCLOAK_CLIENT_ID_SWAGGER:sdmis-api-swagger}
spring.security.oauth2.client.registration.sdmis-api-swagger.client-secret=${KEYCLOAK_CLIENT_SECRET_SWAGGER:changeme}
spring.security.oauth2.client.registration.sdmis-api-swagger.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.sdmis-api-swagger.scope=openid,profile,email,roles
spring.security.oauth2.client.registration.sdmis-api-swagger.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}
#spring.security.oauth2.client.provider.sdmis-api-swagger.issuer-uri=${KEYCLOAK_ISSUER_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS}
spring.security.oauth2.client.provider.sdmis-api-swagger.authorization-uri=${KEYCLOAK_AUTH_URI:${KEYCLOAK_ISSUER_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS}/protocol/openid-connect/auth}
spring.security.oauth2.client.provider.sdmis-api-swagger.token-uri=${KEYCLOAK_TOKEN_URI:${KEYCLOAK_ISSUER_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS}/protocol/openid-connect/token}
spring.security.oauth2.client.provider.sdmis-api-swagger.jwk-set-uri=${KEYCLOAK_JWKS_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS/protocol/openid-connect/certs}

# Swagger UI OAuth2 – override via env si besoin
springdoc.swagger-ui.oauth.client-id=${KEYCLOAK_CLIENT_ID_SWAGGER:sdmis-api-swagger}
springdoc.swagger-ui.oauth.client-secret=${KEYCLOAK_CLIENT_SECRET_SWAGGER}

springdoc.swagger-ui.oauth.use-pkce-with-authorization-code-grant=true
springdoc.swagger-ui.oauth.scopes=openid,profile,email,roles
springdoc.swagger-ui.try-it-out-enabled=true

# CORS (pour les appels front)
spring.web.cors.allowed-origins=*
spring.web.cors.allowed-methods=GET,POST,PUT,PATCH,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.exposed-headers=*
# Respect X-Forwarded-* headers (needed behind HTTPS reverse proxy for correct scheme in Swagger/OpenAPI)
server.forward-headers-strategy=framework

# Keycloak admin client (pour création utilisateur)
keycloak.admin.base-url=${KEYCLOAK_ADMIN_BASE_URL:${KEYCLOAK_ISSUER_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS}/admin/realms/SDMIS}
keycloak.admin.token-url=${KEYCLOAK_ADMIN_TOKEN_URL:${KEYCLOAK_ISSUER_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS}/protocol/openid-connect/token}
keycloak.admin.realm=${KEYCLOAK_ADMIN_REALM:SDMIS}
keycloak.admin.client-id=${KEYCLOAK_ADMIN_CLIENT_ID:}
keycloak.admin.client-secret=${KEYCLOAK_ADMIN_CLIENT_SECRET:}
