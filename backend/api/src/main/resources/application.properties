spring.application.name=sdmis-api

# Datasource configuration (overridable via env)
spring.datasource.url=${SPRING_DATASOURCE_URL}
spring.datasource.username=${SPRING_DATASOURCE_USERNAME}
spring.datasource.password=${SPRING_DATASOURCE_PASSWORD}
spring.datasource.driver-class-name=org.postgresql.Driver

# Keep legacy schema init disabled (DB must exist)
spring.sql.init.mode=never

# JDBC template logging (set to DEBUG to trace queries)
logging.level.org.springframework.jdbc.core=INFO

# CORS (pour les appels front)
spring.web.cors.allowed-origins=*
spring.web.cors.allowed-methods=GET,POST,PUT,PATCH,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.exposed-headers=*

# Respect X-Forwarded-* headers (needed behind HTTPS reverse proxy for correct scheme in Swagger/OpenAPI)
server.forward-headers-strategy=framework

# Sécurité / Keycloak
spring.security.oauth2.resourceserver.jwt.issuer-uri=https://auth.4irc.hugorodrigues.fr/realms/SDMIS
spring.security.oauth2.resourceserver.jwt.jwk-set-uri=https://auth.4irc.hugorodrigues.fr/realms/SDMIS/protocol/openid-connect/certs

# # Client OAuth2 (pour oauth2Login / Swagger)
# Client OAuth2 (pour oauth2Login / Swagger)
spring.security.oauth2.client.registration.sdmis-api-swagger.client-id=${KEYCLOAK_CLIENT_ID:sdmis-api-swagger}
spring.security.oauth2.client.registration.sdmis-api-swagger.client-secret=${KEYCLOAK_CLIENT_SECRET:sY5ogV2N3dn8ODcBcfnCV5llod6BAK5g}
spring.security.oauth2.client.registration.sdmis-api-swagger.authorization-grant-type=authorization_code
spring.security.oauth2.client.registration.sdmis-api-swagger.scope=openid,profile,email,roles
spring.security.oauth2.client.registration.sdmis-api-swagger.redirect-uri={baseUrl}/login/oauth2/code/{registrationId}
spring.security.oauth2.client.provider.sdmis-api-swagger.issuer-uri=https://auth.4irc.hugorodrigues.fr/realms/SDMIS

# Swagger UI OAuth2
springdoc.swagger-ui.oauth.client-id=${KEYCLOAK_CLIENT_ID:sdmis-api-swagger}
springdoc.swagger-ui.oauth.client-secret=${KEYCLOAK_CLIENT_SECRET:sY5ogV2N3dn8ODcBcfnCV5llod6BAK5g}

springdoc.swagger-ui.oauth.use-pkce-with-authorization-code-grant=true
springdoc.swagger-ui.oauth.scopes=openid,profile,email,roles
springdoc.swagger-ui.try-it-out-enabled=true

# CORS (pour les appels front)
spring.web.cors.allowed-origins=*
spring.web.cors.allowed-methods=GET,POST,PUT,PATCH,DELETE,OPTIONS
spring.web.cors.allowed-headers=*
spring.web.cors.exposed-headers=*
# Respect X-Forwarded-* headers (needed behind HTTPS reverse proxy for correct scheme in Swagger/OpenAPI)
server.forward-headers-strategy=framework

# Keycloak admin client (pour création utilisateur)
keycloak.admin.base-url=${KEYCLOAK_ADMIN_BASE_URL:${KEYCLOAK_ISSUER_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS}/admin/realms/SDMIS}
keycloak.admin.token-url=${KEYCLOAK_ADMIN_TOKEN_URL:${KEYCLOAK_ISSUER_URI:https://auth.4irc.hugorodrigues.fr/realms/SDMIS}/protocol/openid-connect/token}
keycloak.admin.realm=${KEYCLOAK_ADMIN_REALM:SDMIS}
keycloak.admin.client-id=${KEYCLOAK_ADMIN_CLIENT_ID:}
keycloak.admin.client-secret=${KEYCLOAK_ADMIN_CLIENT_SECRET:}
